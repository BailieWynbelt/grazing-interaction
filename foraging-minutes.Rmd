---
title: "R Notebook"
output: html_notebook
---

Then, let's remove all objects from the environment to start fresh each time.
```{r}
# clear the enviroment
rm(list=ls(all=TRUE))
```

***
Let's check the working directory to see if it's correct.
```{r}
source(paste0(getwd(), "/environment.R"))

print(currentwd)
```
Looks good for my (Andrew's) PC.

***
First, let's get our R environment ready by loading some useful packages.
```{r include=FALSE}
## the source() funciton executes all lines of code in the "mentioned" script (i.e. the pathway)
source(paste0(currentwd, "/packages.R"))
```

***
I created an external R script with contains all of the functions that I commonly use across different scripts. This chunk of code reads those functions into the global R environment.
```{r}
source(paste0(currentwd, "/functions.R"))
```

***
Read the cleaned photo data generated by "photo-processing.Rmd".
```{r}
all_data <- readr::read_csv('data/photo/all_photo_data.csv', col_names = TRUE, na = c(""," ","NA"))

print(all_data)
```

***
We're going to use a function I created called "speciestotal" (see the functions.R script) which is specific to the way we classified our data. The issue is that the 'Count1Species' column in our dataframes doesn't correspond to a specific species, rather it corresponds to whatever species is the primary species detected (>50% of individuals if a multiple species are detected in an image). 

The "speciestotal" function will count up the number of individuals for each species detected in a camera trap photo and then create a new column in the corresponding dataframe to store this species count. The new column is labled by the species and contains a count of the number of individuals detected in each image.

A second function "allspecies" uses the "speciestotal" function for all of the species possible (24 total), and creates a new column for each species. 
```{r}
all_data_all_species <- allspecies(all_data)

view(all_data_all_species)
```
***

Take a look a the new data frame. We've removed NAs and did some calculations to the data frame which created new columns with species counts.

```{r}
all_data_only_horses <- all_data_all_species %>% dplyr::filter(horse != 0)

print(all_data_only_horses)

BRL_horses_2018 <- all_data_only_horses %>% dplyr::filter(Site == "Bear Timelapse")

print(BRL_horses_2018) 
```

```{r}
BRL_horses_2018 %>% pull(DateTime) %>% lubridate::date() %>% unique()
```

```{r}
BRL_horses_2018_forage_min <- BRL_horses_2018 %>% mutate(forage_min = horse * 1)

print(BRL_horses_2018_forage_min$forage_min)
```

```{r}
BRL_horses_2018_forage_min <- BRL_horses_2018_forage_min %>% mutate(forage_min_weighted = forage_min * 1.1)

print(BRL_horses_2018_forage_min$forage_min_weighted)
```

```{r}
BRL_horses_2018_forage_min %>% pull(forage_min) %>% sum()
BRL_horses_2018_forage_min %>% pull(forage_min_weighted) %>% sum()
```

```{r}
BRL_horses_2018_forage_min <- BRL_horses_2018_forage_min %>% 
   dplyr::mutate(Date = lubridate::date(DateTime), .after = DateTime)

print(BRL_horses_2018_forage_min)
```

```{r}
BRL_2018_summary <- BRL_horses_2018_forage_min %>% dplyr::group_by(Date) %>% dplyr::summarise(sum = sum(forage_min))

BRL_2018_summary
```

```{r}
p <- ggplot(BRL_2018_summary, aes(x = Date, y = sum)) +
   geom_col() +
   scale_x_date(date_labels = "%b", date_breaks = "1 month") +
   labs(title = "Bear Timelapse 2018", subtitle = "Horses") +
   ylab("Unweighted Forage Minutes") +
   theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10)))

p
```

```{r}
# ggsave("Bear-Timelapse-2018-Horses-Unweighted-Forage-Minutes.jpg", 
#     path = paste0(currentwd,"/figures", "/forage-minutes"))
```