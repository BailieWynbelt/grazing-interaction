---
title: "Landscape Appearance"
author: "Andrew Antaya"
date: "3/9/2022"
output: html_notebook
---

First, let's remove all objects from the environment to start fresh each time.

```{r clear env}
# clear the enviroment
rm(list=ls(all=TRUE))
```

Setup the R environment using a separate script. This helps me stay consistent with environmental variables that I use across multiple R scripts.

```{r setup env}
# the source() function executes all lines of code in the "mentioned" script (i.e. the pathway)
source(paste0(getwd(), "/environment.R"))
print(currentwd)
```

Check that the working directory is correct for your computer.

Then, let's get our R environment ready by loading some useful packages.

```{r load packages, include=FALSE}
# "inlcude=FALSE" in the chunk evaluates the code, but doesn't write the output to the knitr document
# loading packages involves alot of output in the console that we don't need in the knitr document
source(paste0(currentwd, "/packages.R"))
```

This separate R script contains all of the functions that I commonly use across multiple scripts. This chunk of code reads in those functions into the global R environment.

```{r load functions}
source(paste0(currentwd, "/functions.R"))
```

```{r}
BGW_2019_landscape_appearance <- readr::read_csv(
  'data/vegetation/white-mountains/2019-boggy-grazed-landscape-appearance.csv',
  col_names = TRUE, 
  na = c(""," ","NA"))

WCS_2019_landscape_appearance <- readr::read_csv(
  'data/vegetation/white-mountains/2019-wildcat-grazed-landscape-appearance.csv',
  col_names = TRUE, 
  na = c(""," ","NA"))

BGW_2019_landscape_appearance
WCS_2019_landscape_appearance
```

```{r}
BGW_2019_landscape_appearance <- 
  BGW_2019_landscape_appearance %>% 
  mutate(Site = "Boggy", Year = "2019")

WCS_2019_landscape_appearance <- 
  WCS_2019_landscape_appearance %>% 
  mutate(Site = "Wildcat", Year = "2019")

BGW_2019_landscape_appearance <- 
  BGW_2019_landscape_appearance %>% 
  dplyr::select(-c( "Species/Category Name", "Species/Category Code", "Qualifier"))

WCS_2019_landscape_appearance <- 
  WCS_2019_landscape_appearance %>% 
  dplyr::select(-c( "Species/Category Name", "Species/Category Code", "Qualifier"))

BGW_2019_landscape_appearance
WCS_2019_landscape_appearance
```

```{r Read in Excel data and convert to csv, eval=FALSE, include=FALSE}
# this code chunk only needs to be turned on once when converting data
# then it can be turned off after the files are converted

# list all of the xlsx data files in the directory
xlsx_file_list <- list.files("data/vegetation/heber/landscape-appearance/xlsx", pattern = "xlsx")

# create a vector of file names that we will use to rename our xlsx files into csv files
# do this by replacing the file extension but otherwise keep the file name the same
file_names <- str_replace_all(xlsx_file_list, "xlsx", "csv")

# create a vector of file paths to tell R where to find the source xlsx data
file_source <- paste0(getwd(), "/data/vegetation/heber/landscape-appearance/xlsx/", xlsx_file_list)

# create a vector of file paths to tell R where to put the files after conversion
file_destination <- paste0(getwd(), "/data/vegetation/heber/landscape-appearance/csv/", file_names)

# for loop through the file list to convert all xlsx files in the directory
# to csv files
for (i in 1:length(file_source)) {
  # read the data from the Stubble Height sheet
  xlsx_data <- openxlsx::read.xlsx(file_source[i], sheet = "Ocular Estimates")
  # write out the xlsm data as an xlsx
  readr::write_csv(xlsx_data, paste0(file_destination[i]), na = "NA")}
```

```{r}
heber_file_list <- list.files("data/vegetation/heber/landscape-appearance/csv", pattern = "csv")

heber_file_list
```

```{r load data}
BKS_2018_landscape_data <-
  readr::read_csv(
    paste0(
      getwd(),
      "/data/vegetation/heber/landscape-appearance/csv/",
      "2018-BKS-landscape-appearance.csv"),
      col_names = TRUE,
      na = c("", " ", "NA")
    )

BRL_2018_landscape_data <-
  readr::read_csv(
    paste0(
      getwd(),
      "/data/vegetation/heber/landscape-appearance/csv/",
      "2018-BRL-landscape-appearance.csv"),
      col_names = TRUE,
      na = c("", " ", "NA")
    )

A51_2019_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2019-A51-landscape-appearance.csv"),
    col_names = TRUE,
    na = c("", " ", "NA")
  )

BKN_2019_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2019-BKN-landscape-appearance.csv"
  )
)
BRL_2019_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2019-BRL-landscape-appearance.csv"
  )
)
A51_2020_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2020-A51-landscape-appearance.csv"
  )
)

BKN_2020_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2020-BKN-landscape-appearance.csv"
  )
)

BKS_2020_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2020-BKS-landscape-appearance.csv"
  )
)

BRL_2020_landscape_data <- readr::read_csv(
  paste0(
    getwd(),
    "/data/vegetation/heber/landscape-appearance/csv/",
    "2020-BRL-landscape-appearance.csv"
  )
)

```

```{r view data}
BKS_2018_landscape_data
BRL_2018_landscape_data
A51_2019_landscape_data
BKN_2019_landscape_data
BRL_2019_landscape_data
A51_2020_landscape_data
BKN_2020_landscape_data
BKS_2020_landscape_data
BRL_2020_landscape_data
```

```{r}
BKS_2018_landscape_data <-
  BKS_2018_landscape_data %>% mutate(Site = "BKS", Year = "2018")

BRL_2018_landscape_data <-
  BRL_2018_landscape_data %>% mutate(Site = "BRL", Year = "2018")

A51_2019_landscape_data <-
  A51_2019_landscape_data %>% mutate(Site = "A51", Year = "2019")

BKN_2019_landscape_data <-
  BKN_2019_landscape_data %>% mutate(Site = "BKN", Year = "2019")

BRL_2019_landscape_data <-
  BRL_2019_landscape_data %>% mutate(Site = "BRL", Year = "2019")

A51_2020_landscape_data <-
  A51_2020_landscape_data %>% mutate(Site = "A51", Year = "2020")

BKN_2020_landscape_data <-
  BKN_2020_landscape_data %>% mutate(Site = "BKN", Year = "2020")

BKS_2020_landscape_data <-
  BKS_2020_landscape_data %>% mutate(Site = "BKS", Year = "2020")

BRL_2020_landscape_data <-
  BRL_2020_landscape_data %>% mutate(Site = "BRL", Year = "2020")
```

```{r bind rows all years}
heber_2018_landscape_appearance <- dplyr::bind_rows(BKS_2018_landscape_data,
                                                    BRL_2018_landscape_data)

heber_2019_landscape_appearance <- dplyr::bind_rows(A51_2019_landscape_data, 
                                                    BKN_2019_landscape_data,
                                                    BRL_2019_landscape_data)

heber_2020_landscape_appearance <- dplyr::bind_rows(A51_2020_landscape_data,
                                                    BKN_2020_landscape_data,
                                                    BKS_2020_landscape_data,
                                                    BRL_2020_landscape_data)
```

```{r view rbind data}
print(heber_2018_landscape_appearance)
print(heber_2019_landscape_appearance)
print(heber_2020_landscape_appearance)
```

The "Site" and "Year" columns are on the far-right of each data frame, and we want to move them to the left side for easier viewing. Additionally, the 2018 data is in a different format than 2019 or 2020 data, so we need to reference difference columns when relocating the "Site" and "Year" columns.

```{r}
heber_2018_landscape_appearance <-
  heber_2018_landscape_appearance %>% dplyr::rename("Class Mid-Point" = "class_score")

heber_2018_landscape_appearance <-
  heber_2018_landscape_appearance %>% dplyr::relocate(c("Site", "Year"), .before = "Class Mid-Point")

heber_2019_landscape_appearance <-
  heber_2019_landscape_appearance %>% dplyr::rename("Class Mid-Point" = "%.Estimate")

heber_2019_landscape_appearance <-
  heber_2019_landscape_appearance %>% dplyr::relocate(c("Site", "Year"), .before = "Transect")

heber_2020_landscape_appearance <-
  heber_2020_landscape_appearance %>% dplyr::rename("Class Mid-Point" = "%.Estimate")

heber_2020_landscape_appearance <-
  heber_2020_landscape_appearance %>% dplyr::relocate(c("Site", "Year"), .before = "Transect")

print(heber_2018_landscape_appearance)
print(heber_2019_landscape_appearance)
print(heber_2020_landscape_appearance)
```

## Calculate 2018 Landscape Appearance

It's probably best if we don't row bind two tables of counts together, so instead we will use dplyr to filter out the Bear 2018 data and keep the Black Canyon 2018 data.

```{r}
BKS_2018_landscape_appearance <- heber_2018_landscape_appearance %>% dplyr::filter(Site == "BKS")

print(BKS_2018_landscape_appearance)
```

Now we'll do the inverse, keep the Bear 2018 data and filter out the Black Canyon South 2018 data.

```{r}
BRL_2018_landscape_appearance <- heber_2018_landscape_appearance %>% dplyr::filter(Site == "BRL")

print(BRL_2018_landscape_appearance)
```

```{r}
BKS_2018_la_expand <- rep(BKS_2018_landscape_appearance$`Class Mid-Point`[1], times = BKS_2018_landscape_appearance$count[1])

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[2], times = BKS_2018_landscape_appearance$count[2]))

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[3], times = BKS_2018_landscape_appearance$count[3]))

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[4], times = BKS_2018_landscape_appearance$count[4]))

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[5], times = BKS_2018_landscape_appearance$count[5]))

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[6], times = BKS_2018_landscape_appearance$count[6]))

BKS_2018_la_expand <- append(BKS_2018_la_expand, rep(BKS_2018_landscape_appearance$`Class Mid-Point`[7], times = BKS_2018_landscape_appearance$count[7]))

BKS_2018_la_expand

```

```{r}
length(BKS_2018_la_expand)
```

```{r}
BRL_2018_la_expand <- rep(BRL_2018_landscape_appearance$`Class Mid-Point`[1], times = BRL_2018_landscape_appearance$count[1])

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[2], times = BRL_2018_landscape_appearance$count[2]))

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[3], times = BRL_2018_landscape_appearance$count[3]))

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[4], times = BRL_2018_landscape_appearance$count[4]))

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[5], times = BRL_2018_landscape_appearance$count[5]))

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[6], times = BRL_2018_landscape_appearance$count[6]))

BRL_2018_la_expand <- append(BRL_2018_la_expand, rep(BRL_2018_landscape_appearance$`Class Mid-Point`[7], times = BRL_2018_landscape_appearance$count[7]))

BRL_2018_la_expand
```

```{r}
length(BRL_2018_la_expand)
```

Re-create a data frame using the table of counts from the Bear 2018 data. This was done to make it easier to calculate summary statistics.

```{r}
BRL_2018_la_tibble <- tibble::tibble(Site = "BRL", 
                                     Year = "2018", 
                                     Sample = seq(1:length(BRL_2018_la_expand)), 
                                     `Class Mid-Point` = BRL_2018_la_expand)

BRL_2018_la_tibble
```

Re-create a data frame using the table of counts from the Black Canyon 2018 data. This was done to make it easier to calculate summary statistics.

```{r}
BKS_2018_la_tibble <- tibble::tibble(Site = "BKS", 
                                     Year = "2018", 
                                     Sample = seq(1:length(BKS_2018_la_expand)), 
                                     `Class Mid-Point` = BKS_2018_la_expand)

BKS_2018_la_tibble
```

```{r}
BKS_2018_stats <- BKS_2018_la_tibble %>% rstatix::get_summary_stats('Class Mid-Point', type = "common")

BKS_2018_stats
```

```{r}
BRL_2018_stats <- BRL_2018_la_tibble %>% rstatix::get_summary_stats('Class Mid-Point', type = "common")

BRL_2018_stats
```

Because we have a table of counts, we need to create a new column called "product" which is the product of multiplying the "Class Mid-Point" column by the "count" column.

```{r calc product BKS 2018}
BKS_2018_landscape_appearance <- BKS_2018_landscape_appearance %>% dplyr::mutate(product = `Class Mid-Point` * count)

BKS_2018_landscape_appearance
```

Do the same for the Bear 2018 site.

```{r calc product BRL 2018}
BRL_2018_landscape_appearance <- BRL_2018_landscape_appearance %>% dplyr::mutate(product = `Class Mid-Point` * count)

BRL_2018_landscape_appearance
```

Calculate the number of landscape appearance samples taken at each site for 2018.

```{r}
BKS_2018_la_nsamples <- sum(BKS_2018_landscape_appearance$count)
BRL_2018_la_nsamples <- sum(BRL_2018_landscape_appearance$count)

print(BKS_2018_la_nsamples)
print(BRL_2018_la_nsamples)
```

In 2018, we took 52 samples at the Black Canyon South site, and 62 samples at the Bear site. It's hard to say why we took 10 more samples at the Bear site, my guess is that we lost track of how many samples we had taken a did an extra 10.

To get average percent utilization, we sum the "product" column and divide it by the number of samples taken at each site.

Average percent utilization for Black Canyon South 2018.

```{r}
BKS_2018_la_avg <- sum(BKS_2018_landscape_appearance$product) / BKS_2018_la_nsamples

BKS_2018_la_avg
```

Average percent utilization for Bear 2018.

```{r}
BRL_2018_la_avg <- sum(BRL_2018_landscape_appearance$product) / BRL_2018_la_nsamples

BRL_2018_la_avg
```

```{r add site and year to BRL 2018 stats}
BRL_2018_stats <- BRL_2018_stats %>% add_column(Site = "Bear", Year = "2018", .before = "variable")

BRL_2018_stats
```

```{r add site and year to BKS 2018 stats}
BKS_2018_stats <- BKS_2018_stats %>% add_column(Site = "Black Canyon South", Year = "2018", .before = "variable")

BKS_2018_stats
```

```{r row bind 2018 stats}
heber_2018_stats <- dplyr::bind_rows(BRL_2018_stats, BKS_2018_stats)

heber_2018_stats
```


### Plot 2018 Landscape Appearance

```{r 2018 Heber Landscape Appearance Figure}
ggplot(heber_2018_stats, aes(fill = Site, x = Site, y = mean)) +
  geom_col(width = 0.75) +
  guides(fill = "none") +
  labs(title = "Heber Landscape Appearance 2018", caption = "n = number of samples") +
  ylab(expression(atop("Average % Utilization ± 95% CI", paste("(lower is better)")))) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +
  # add % utilization values above the  error bars
  # round the mean value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (heber_2018_stats$mean[1] + heber_2018_stats$ci[1] + 7), 
           label = paste0(signif(heber_2018_stats$mean[1], 2), "%")) +
  annotate(geom = "text", 
           x = 2, 
           y = (heber_2018_stats$mean[2] + heber_2018_stats$ci[2] + 7), 
           label = paste0(signif(heber_2018_stats$mean[2], 2), "%")) +
  # add sample sizes to each bar
  annotate(geom = "text",
           x = 1,
           y = (heber_2018_stats$mean[1] / 2),
           label = paste("n", "=", heber_2018_stats$n[1], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 2,
           y = (heber_2018_stats$mean[2] / 2),
           label = paste("n", "=", heber_2018_stats$n[2], sep = " "),
           size = 3)

ggsave("2018-Heber-Landscape-Appearance-95CI.jpg",
   path = paste0(getwd(),"/figures", "/landscape-appearance"))
```

## Calculate 2019 Landscape Appearance

In 2019, we took 25 landscape appearance samples at each site, along a single transect at each site.

```{r}
heber_2019_landscape_appearance
```

One of the class mid-points was incorrectly recorded for the 2019 data. We recorded the 88% class mid-point incorrectly as "90%". We can do a simple string replace to change all of the 90% values to 88%.

```{r}
heber_2019_landscape_appearance$'Class Mid-Point' <- 
  heber_2019_landscape_appearance %>% pull(`Class Mid-Point`) %>% str_replace_all("90", "88")

heber_2019_landscape_appearance$'Class Mid-Point' <- heber_2019_landscape_appearance %>% 
  pull(`Class Mid-Point`) %>% 
  as.numeric()

heber_2019_landscape_appearance
```

```{r}
heber_2019_landscape_appearance <-
  heber_2019_landscape_appearance %>%
  mutate(Factor = forcats::as_factor(heber_2019_landscape_appearance$`Class Mid-Point`))

heber_2019_landscape_appearance
```

```{r}
levels(heber_2019_landscape_appearance %>% pull(Factor))
```

```{r}
heber_2019_landscape_appearance$Factor <- heber_2019_landscape_appearance %>% 
  pull("Factor") %>% 
  fct_expand("97.5")

levels(heber_2019_landscape_appearance %>% pull("Factor"))
```

```{r}
# heber_2019_landscape_appearance$Factor <- heber_2019_landscape_appearance %>% 
#   pull("Factor") %>% 
#   fct_relabel(~ gsub("90", "88", .x))
# 
# levels(heber_2019_landscape_appearance %>% pull("Factor"))
```

```{r}
BGW_2019_stats <- BGW_2019_landscape_appearance %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

WCS_2019_stats <- WCS_2019_landscape_appearance %>%
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BGW_2019_stats <- BGW_2019_stats %>% add_column(Site = "Boggy Creek", .before = "variable")

WCS_2019_stats <- WCS_2019_stats %>% add_column(Site = "Wildcat Creek", .before = "variable")

BGW_2019_stats

WCS_2019_stats
```

```{r}
white_mountains_2019_stats <- dplyr::bind_rows(BGW_2019_stats, WCS_2019_stats)

white_mountains_2019_stats
```

```{r}
A51_2019_stats <- heber_2019_landscape_appearance %>% 
  dplyr::filter(Site == "A51")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BKN_2019_stats <- heber_2019_landscape_appearance %>% 
  dplyr::filter(Site == "BKN")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BRL_2019_stats <- heber_2019_landscape_appearance %>% 
  dplyr::filter(Site == "BRL")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

A51_2019_stats
BKN_2019_stats
BRL_2019_stats
```

```{r}
A51_2020_stats <- heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "A51")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BKN_2020_stats <- heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BKN")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BRL_2020_stats <- heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BRL")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")

BKS_2020_stats <- heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BKS")  %>% 
  rstatix::get_summary_stats('Class Mid-Point', type = "common")
                             
A51_2020_stats
BKN_2020_stats
BRL_2020_stats
BKS_2020_stats
```

```{r}
A51_2019_stats <- A51_2019_stats %>% add_column(Site = "Fifty One", .before = "variable")

BKN_2019_stats <- BKN_2019_stats %>% add_column(Site = "Black Canyon North", .before = "variable")

BRL_2019_stats <- BRL_2019_stats %>% add_column(Site = "Bear", .before = "variable")

A51_2019_stats
BKN_2019_stats
BRL_2019_stats
```

```{r}
A51_2020_stats <- A51_2020_stats %>% add_column(Site = "Fifty One", .before = "variable")

BKN_2020_stats <- BKN_2020_stats %>% add_column(Site = "Black Canyon North", .before = "variable")

BRL_2020_stats <- BRL_2020_stats %>% add_column(Site = "Bear", .before = "variable")

BKS_2020_stats <- BKS_2020_stats %>% add_column(Site = "Black Canyon South", .before = "variable")

A51_2020_stats
BKN_2020_stats
BRL_2020_stats
BKS_2020_stats
```

```{r}
heber_2019_stats <- bind_rows(BRL_2019_stats, BKN_2019_stats, A51_2019_stats)

heber_2019_stats
```

```{r}
heber_2019_stats$Site <- heber_2019_stats %>% pull(Site) %>% forcats::as_factor()

heber_2019_stats$Site <- heber_2019_stats %>% pull(Site) %>% forcats::fct_inorder()

heber_2019_stats
```

```{r}
heber_2020_stats <- bind_rows(BRL_2020_stats, BKN_2020_stats, BKS_2020_stats, A51_2020_stats)

heber_2020_stats
```

```{r}
heber_2020_stats$Site <- heber_2020_stats %>% pull(Site) %>% forcats::as_factor()

heber_2020_stats$Site <- heber_2020_stats %>% pull(Site) %>% forcats::fct_inorder()

heber_2020_stats
```

```{r}
# A51_2019 <- heber_2019_landscape_appearance %>%
#   dplyr::filter(Site == "A51") %>% 
#   pull('Class Mid-Point') %>% 
#   table() %>% 
#   as.data.frame()
# 
# A51_2019
```

```{r}
# heber_2020_landscape_appearance <-
#   heber_2020_landscape_appearance %>% dplyr::rename("Class Mid-Point" = "%.Estimate")

heber_2020_landscape_appearance <-
  heber_2020_landscape_appearance %>% dplyr::relocate(c("Site", "Year"), .before = "Transect")

heber_2020_landscape_appearance$`Class Mid-Point` <-
  heber_2020_landscape_appearance %>%
  pull('Class Mid-Point') %>%
  forcats::as_factor()

heber_2020_landscape_appearance
```

```{r}
levels(heber_2020_landscape_appearance %>% pull("Class Mid-Point"))
```

```{r}
A51_2019_class_midpoints <- 
  heber_2019_landscape_appearance %>% 
  dplyr::filter(Site == "A51") %>% 
  pull(`Factor`) %>%
  forcats::fct_count()

BKN_2019_class_midpoints <-
  heber_2019_landscape_appearance %>%
  dplyr::filter(Site == "BKN") %>%
  pull(`Factor`) %>%
  forcats::fct_count()

BRL_2019_class_midpoints <-
  heber_2019_landscape_appearance %>%
  dplyr::filter(Site == "BRL") %>%
  pull(`Factor`) %>%
  forcats::fct_count()

A51_2019_class_midpoints
BKN_2019_class_midpoints
BRL_2019_class_midpoints
```

```{r}
A51_2019_class_midpoints <- A51_2019_class_midpoints %>% mutate(midpoint = as.character(f))

A51_2019_class_midpoints$midpoint <- as.numeric(A51_2019_class_midpoints$midpoint)

BKN_2019_class_midpoints <- BKN_2019_class_midpoints %>% mutate(midpoint = as.character(f))

BKN_2019_class_midpoints$midpoint <- as.numeric(BKN_2019_class_midpoints$midpoint)

BRL_2019_class_midpoints <- BRL_2019_class_midpoints %>% mutate(midpoint = as.character(f))

BRL_2019_class_midpoints$midpoint <- as.numeric(BRL_2019_class_midpoints$midpoint)

A51_2019_class_midpoints
BKN_2019_class_midpoints
BRL_2019_class_midpoints
```

```{r}
A51_2019_class_midpoints <- A51_2019_class_midpoints %>% mutate(product = midpoint * n)

BKN_2019_class_midpoints <- BKN_2019_class_midpoints %>% mutate(product = midpoint * n)

BRL_2019_class_midpoints <- BRL_2019_class_midpoints %>% mutate(product = midpoint * n)

A51_2019_class_midpoints
BKN_2019_class_midpoints
BRL_2019_class_midpoints
```

```{r}
A51_2019_sum <- sum(A51_2019_class_midpoints$product)

BKN_2019_sum <- sum(BKN_2019_class_midpoints$product)

BRL_2019_sum <- sum(BRL_2019_class_midpoints$product)

A51_2019_sum
BKN_2019_sum
BRL_2019_sum
```

```{r}
A51_2019_num_observations <- A51_2019_class_midpoints %>% pull('n') %>% sum()

BKN_2019_num_observations<- BKN_2019_class_midpoints %>% pull('n') %>% sum()

BRL_2019_num_observations <- BRL_2019_class_midpoints %>% pull('n') %>% sum()

A51_2019_num_observations

BKN_2019_num_observations

BRL_2019_num_observations
```

```{r}
A51_2019_sum / A51_2019_num_observations

BKN_2019_sum / BKN_2019_num_observations

BRL_2019_sum / BRL_2019_num_observations
```

```{r}
A51_2020_class_midpoints <- 
  heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "A51" & Year == 2020) %>% 
  pull(`Class Mid-Point`) %>% 
  forcats::fct_count()

BKN_2020_class_midpoints <- 
  heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BKN" & Year == 2020) %>% 
  pull(`Class Mid-Point`) %>% 
  forcats::fct_count()

BKS_2020_class_midpoints <- 
  heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BKS" & Year == 2020) %>% 
  pull(`Class Mid-Point`) %>% 
  forcats::fct_count()

BRL_2020_class_midpoints <- 
  heber_2020_landscape_appearance %>% 
  dplyr::filter(Site == "BRL" & Year == 2020) %>% 
  pull(`Class Mid-Point`) %>% 
  forcats::fct_count()

A51_2020_class_midpoints
BKN_2020_class_midpoints
BKS_2020_class_midpoints
BRL_2020_class_midpoints
```

## Plot 2019 Landscape Appearance

### White Mountains 2019

```{r 2019 White Mountains Landscape Appearance Figure, eval=FALSE}
ggplot(white_mountains_2019_stats, aes(fill = Site, x = Site, y = mean)) +
  geom_col(width = 0.75) +
  guides(fill = "none") +
  labs(title = "White Mountains Landscape Appearance 2019", caption = "n = number of samples") +
  ylab(expression(atop("Average % Utilization ± 95% CI", paste("(lower is better)")))) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +
  # add % utilization values above the  error bars
  # round the mean value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (white_mountains_2019_stats$mean[1] + white_mountains_2019_stats$ci[1] + 7), 
           label = paste0(signif(white_mountains_2019_stats$mean[1], 2), "%")) +
  annotate(geom = "text", 
           x = 2, 
           y = (white_mountains_2019_stats$mean[2] + white_mountains_2019_stats$ci[2] + 7), 
           label = paste0(signif(white_mountains_2019_stats$mean[2], 2), "%")) +
  # add sample sizes to each bar
  annotate(geom = "text",
           x = 1,
           y = (white_mountains_2019_stats$mean[1] / 2),
           label = paste("n", "=", white_mountains_2019_stats$n[1], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 2,
           y = (white_mountains_2019_stats$mean[2] / 2),
           label = paste("n", "=", white_mountains_2019_stats$n[2], sep = " "),
           size = 3)

ggsave("2019-White-Mountains-Landscape-Appearance-95CI.jpg",
  path = paste0(getwd(),"/figures", "/landscape-appearance"))
```
### Heber 2019

```{r 2019 Heber Landscape Appearance Figure, eval=FALSE}
ggplot(heber_2019_stats, aes(fill = Site, x = Site, y = mean)) +
  geom_col(width = 0.75) +
  guides(fill = "none") +
  labs(title = "Heber Landscape Appearance 2019", caption = "n = number of samples") +
  ylab(expression(atop("Average % Utilization ± 95% CI", paste("(lower is better)")))) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +
  # add % utilization values above the  error bars
  # round the mean value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (heber_2019_stats$mean[1] + heber_2019_stats$ci[1] + 7), 
           label = paste0(signif(heber_2019_stats$mean[1], 2), "%")) +
  annotate(geom = "text", 
           x = 2, 
           y = (heber_2019_stats$mean[2] + heber_2019_stats$ci[2] + 7), 
           label = paste0(signif(heber_2019_stats$mean[2], 2), "%")) +
  annotate(geom = "text", 
           x = 3, 
           y = (heber_2019_stats$mean[3] + heber_2019_stats$ci[3] + 7), 
           label = paste0(signif(heber_2019_stats$mean[3], 2), "%")) +
  # add sample sizes to bars
  annotate(geom = "text",
           x = 2,
           y = 0,
           label = paste("n", "=", heber_2019_stats$n[2], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 1,
           y = (heber_2019_stats$mean[1] / 2),
           label = paste("n", "=", heber_2019_stats$n[1], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 3,
           y = (heber_2019_stats$mean[3] / 2),
           label = paste("n", "=", heber_2019_stats$n[3], sep = " "),
           size = 3)

ggsave("2019-Heber-Landscape-Appearance-95CI.jpg", 
   path = paste0(getwd(),"/figures", "/landscape-appearance"))
```

```{r}
heber_2020_stats$mean[2] - heber_2020_stats$ci[2] 

heber_2020_stats$mean[2] + heber_2020_stats$ci[2] 
```

```{r}
heber_2019_stats$mean[2] - heber_2019_stats$ci[2] 

heber_2019_stats$mean[2] + heber_2019_stats$ci[2] 
```


## Plot 2020 Landscape Appearance

### Heber 2020

```{r 2020 Heber Landscape Appearance Figure, eval=FALSE}
ggplot(heber_2020_stats, aes(fill = Site, x = Site, y = mean)) +
  geom_col(width = 0.75) +
  guides(fill = "none") +
  labs(title = "Heber Landscape Appearance 2020", caption = "n = number of samples") +
  ylab(expression(atop("Average % Utilization ± 95% CI", paste("(lower is better)")))) +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, by = 10)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +
  # add % utilization values above the  error bars
  # round the mean value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (heber_2020_stats$mean[1] + heber_2020_stats$ci[1] + 7), 
           label = paste0(signif(heber_2020_stats$mean[1], 2), "%")) +
  annotate(geom = "text", 
           x = 2, 
           y = (heber_2020_stats$mean[2] + heber_2020_stats$ci[2] + 7), 
           label = paste0(signif(heber_2020_stats$mean[2], 2), "%")) +
  annotate(geom = "text", 
           x = 3, 
           y = (heber_2020_stats$mean[3] + heber_2020_stats$ci[3] + 7), 
           label = paste0(signif(heber_2020_stats$mean[3], 2), "%")) +
  annotate(geom = "text", 
           x = 4, 
           y = (heber_2020_stats$mean[4] + heber_2020_stats$ci[4] + 7), 
           label = paste0(signif(heber_2020_stats$mean[4], 2), "%")) +
  # add sample sizes to bars
  annotate(geom = "text",
           x = 1,
           y = (heber_2020_stats$mean[1] / 2),
           label = paste("n", "=", heber_2020_stats$n[1], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 2,
           y = (heber_2020_stats$mean[2] / 2),
           label = paste("n", "=", heber_2020_stats$n[2], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 3,
           y = (heber_2020_stats$mean[3] / 2),
           label = paste("n", "=", heber_2020_stats$n[3], sep = " "),
           size = 3) +
  annotate(geom = "text",
           x = 4,
           y = (heber_2020_stats$mean[4] / 2),
           label = paste("n", "=", heber_2020_stats$n[4], sep = " "),
           size = 3)
ggsave("2020-Heber-Landscape-Appearance-95CI.jpg", 
   path = paste0(getwd(),"/figures", "/landscape-appearance"))
```
