---
title: "Photo Data Pre-Processing- White Mountains, Arizona"
author: "Andrew Antaya"
output:
  html_notebook: default
  pdf_document: default
  word_document: default
---
***
First, let's get our R environment ready by loading some useful packages.
```{r}
# load packages and dependencies
library("ggplot2", lib.loc= "~/R/win-library/3.5")
library("dplyr", lib.loc= "~/R/win-library/3.5")
library("jpeg", lib.loc= "~/R/win-library/3.5")
library("viridis", lib.loc = "~/R/win-library/3.5")
library("scales", lib.loc = "~/R/win-library/3.5")
```
***

Then, let's remove all objects from the environment to start fresh each time.
```{r}
# clear the enviroment
rm(list=ls(all=TRUE))
```

***
Let's check the working directory to see if it's correct.
```{r}
# check working directory
getwd()
```
Looks good for my (Andrew's) PC

***
I created an external R script with contains all of the functions that I commongly use across different scripts. This chunk of code reads in those functions into the global R environment. 
```{r}
## the source() funciton executes all lines of code in the "mentioned" script (i.e. the pathway)
source(file = "functions.R")
```

***
Let's read in the RAW photo data from 2017 and 2018, which human observers classified in a custom Excel macro (written in VBA). These RAW photo data files have a file extension of .xlsm. We then saved the .xlsm files as .csv files for ease of use in R and to convert to a non-proprietary format.

For the first step in cleaing up the data, we are going to treat all fields with "" (blanks), " " (spaces- typically accidental input which is invisble in Excel), or "NA" (characters),  as NA's inside R. This will help us deal with missing information in our dataset.
```{r}
## read in the 2017 data, treating all blanks, spaces, and "NA"s as NA's
BGW17RAW<-read.csv('data/photo/BGW_Analysis_2017.csv', header=TRUE, na.strings=c(""," ","NA"))
WCS17RAW<-read.csv('data/photo/WCS_Analysis_2017.csv', header=TRUE, na.strings=c(""," ","NA"))
## read in the 2018 data, treating all blanks, spaces, and "NA"s as NA's
BGX18RAW<-read.csv('data/photo/BGX_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
BGW18RAW<-read.csv('data/photo/BGW_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
BGT18RAW<-read.csv('data/photo/BGT_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
WCX18RAW<-read.csv('data/photo/WCX_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
WCS18RAW<-read.csv('data/photo/WCS_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
WCT18RAW<-read.csv('data/photo/WCT_Analysis_2018.csv', header=TRUE, na.strings=c(""," ","NA"))
```

***
We read in 8 CSV files containing the camera data. Each dataframe corresponds to a site and year (e.g., BGW18 is Boggy West Timelapse, data from year 2018). Each dataframe has a variable number of rows, with each row corresponding to a single image. Each dataframe has 165 columns which correspond to variables.
```{r}
str(BGW17RAW)
```
***
Some of the images we classified in the Excel macro were 'empty' (i.e. the observer could not detect a subject in the image). We want remove these empty images from analysis.

The 'Count1Species' column in each dataframe corresponds to the 1st detected species (i.e. the primary species (>50%) if more than one species is detected in a photo). If the image is 'empty' then it will have 'NA' for a value in the 'Count1Species' column. We're going to use the function complete.cases() to remove all of the rows that have NA in the 'Count1Species' column, from each of the dataframes, and save these new dataframes into new objects. 
```{r}
## remove the observations that have NAs in the Count1Species column
BGT18<- BGT18RAW[complete.cases(BGT18RAW[ , 'Count1Species']),]
BGW17<- BGW17RAW[complete.cases(BGW17RAW[ , 'Count1Species']),]
BGW18<- BGW18RAW[complete.cases(BGW18RAW[ , 'Count1Species']),]
BGX18<- BGX18RAW[complete.cases(BGX18RAW[ , 'Count1Species']),]
WCS17<- WCS17RAW[complete.cases(WCS17RAW[ , 'Count1Species']),]
WCS18<- WCS18RAW[complete.cases(WCS18RAW[ , 'Count1Species']),]
WCT18<- WCT18RAW[complete.cases(BGW18RAW[ , 'Count1Species']),]
WCX18<- WCX18RAW[complete.cases(BGW18RAW[ , 'Count1Species']),]
```

***
We no longer need the Raw dataframes, so we can remove them from our environment.
```{r}
rm(BGT18RAW, BGW17RAW, BGW18RAW, BGX18RAW, WCS17RAW, WCS18RAW, WCT18RAW, WCX18RAW)
```


```{r}
speciestotal <- function(cameradf, species) {
  ## calculate the number of horses in from the 1st detection, store that in new column 

  count1 <- ifelse(cameradf$Count1Species %in% species, cameradf$Count1Total, 0)
  count2 <- ifelse(cameradf$Count2Species %in% species, cameradf$Count2Total, 0)
  count3 <- ifelse(cameradf$Count3Species %in% species, cameradf$Count3Total, 0)
  total <- (count1+count2+count3)
  return(total)
}
```


