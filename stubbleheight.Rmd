---
title: "Stubble Height"
author: "Andrew Antaya"
date: "June 20, 2019"
output: html_notebook
---

```{r}
# clear the environment
rm(list = ls(all = TRUE))
```

```{r}
source("environment.R")
```

```{r echo=FALSE}
source("packages.R")
```

```{r}
source("functions.R")
```

```{r}
sessionInfo()
```


The data exported from VGS is an xlsx file with two sheets. The first sheet is "metadata" and does not contain any data. The second sheet is "Stubble Height" and contains our stubble height data. For our purposes, we only want to keep the sheet with the data.
```{r Read in Excel data and convert to csv, eval=FALSE, include=FALSE}
# this code chunk only needs to be turned on once
# when converting data then it can be turned off
# after the files are converted

# list all of the xlsx data files in the
# directory
xlsx_file_list <- list.files(
  "data/vegetation/heber/stubble-height/xlsx", pattern = "xlsx"
)

# create a vector of file names that we will use
# to rename our xlsx files into csv files do this
# by replacing the file extension but otherwise
# keep the file name the same
file_names <- str_replace_all(xlsx_file_list, "xlsx", "csv")

# create a vector of file paths to tell R where
# to find the source xlsx data
file_source <- paste0(
  getwd(), "/data/vegetation/heber/stubble-height/xlsx/",
  xlsx_file_list
)

# create a vector of file paths to tell R where
# to put the files after conversion
file_destination <- paste0(
  getwd(), "/data/vegetation/heber/stubble-height/csv/",
  file_names
)

# for loop through the file list to convert all
# xlsx files in the directory to csv files
for (i in 1:length(file_source)) {
  # read the data from the Stubble Height sheet
  xlsx_data <- openxlsx::read.xlsx(file_source[i], sheet = "Stubble Height")
  # write out the xlsm data as an xlsx
  readr::write_csv(
    xlsx_data, paste0(file_destination[i]),
    na = "NA"
  )
}
```

Read in the White Mountain data, from 2017 to 2019.
```{r load White Mountain data}
BGW17stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2017-boggy-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

WCS17stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2017-wildcat-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BGW18stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2018-boggy-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

WCS18stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2018-wildcat-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BGW19stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2019-boggy-grazed-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

WCS19stubble <- readr::read_csv(
  "data/vegetation/white-mountains/2019-wildcat-grazed-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BGW17stubble
WCS17stubble
WCS18stubble
BGW19stubble
WCS19stubble
```

Read in the Heber data, from 2018 to 2020.
```{r load Heber data}
BKS18stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2018-BKS-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BRL18stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2018-BRL-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

A5119stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2019-A51-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BKN19stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2019-BKN-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BRL19stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2019-BRL-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)
A5120stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2020-A51-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BKN20stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2020-BKN-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BKS20stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2020-BKS-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BRL20stubble <- readr::read_csv(
  "data/vegetation/heber/stubble-height/csv/2020-BRL-stubble-height.csv",
  col_names = TRUE, na = c("", " ", "NA")
)

BKS18stubble
BRL18stubble
A5119stubble
BKN19stubble
BRL19stubble
A5120stubble
BKN20stubble
BKS20stubble
BRL20stubble
```

The 2018 Heber stubble height data was collected differently and only has three columns. We need to convert the "grazed" and "ungrazed" columns into a single column to make it the same as the 2019 and 2020 data.
```{r mutate 2018 Heber data}
# add two columns with the Site and Year to help us keep track of the data
BKS18stubble <- BKS18stubble %>% 
  dplyr::mutate(Site = "BKS", Year = 2018)

BRL18stubble <- BRL18stubble %>% 
  dplyr::mutate(Site = "BRL", Year = 2018)

# bind the 2018 heber data together for easier manipulation
heber_stubble_2018 <- dplyr::bind_rows(BKS18stubble, BRL18stubble)

# rename the "sample" column to "Record" to bring it inline with the 2019 and 2020 data
heber_stubble_2018 <- heber_stubble_2018 %>% 
  dplyr::rename(Sample = sample)

# convert the NA values in the "ungrazed" column to zero 
# this will make it easier to add values together 
# (i.e., you can't add a number to a NA) 
heber_stubble_2018$ungrazed <- heber_stubble_2018 %>% 
  pull(ungrazed) %>% 
  tidyr::replace_na(0)

# convert the NA values in the "grazed" column to zero 
# this will make it easier to add values together 
heber_stubble_2018$grazed <- heber_stubble_2018 %>% 
  pull(grazed) %>% 
  tidyr::replace_na(0)

# add the "grazed" and "ungrazed" values together into a new column 
# this will bring it inline with the 2019 and 2020 data
# also drop the "grazed" and "ungrazed" columns and keep the unused columns
heber_stubble_2018 <- heber_stubble_2018 %>% 
  dplyr::mutate("Height" = grazed + ungrazed, .keep = "unused")

# print the data frame to view the changes
heber_stubble_2018
```

The 2019 and 2020 Heber data was collected with VGS and is very similar to
but not exactly the same as the White Mountains data for the same years.
Two column names are slightly different in the Heber data that we need to fix.
```{r}
# add two columns with the Site and Year to help us keep track of the data
A5119stubble <- A5119stubble %>% 
  dplyr::mutate(Site = "A51", Year = 2019)

BKN19stubble <- BKN19stubble %>% 
  dplyr::mutate(Site = "BKN", Year = 2019)

BRL19stubble <- BRL19stubble %>% 
  dplyr::mutate(Site = "BRL", Year = 2019)

A5120stubble <- A5120stubble %>% 
  dplyr::mutate(Site = "A51", Year = 2020)

BKN20stubble <- BKN20stubble %>% 
  dplyr::mutate(Site = "BKN", Year = 2020)

BKS20stubble <- BKS20stubble %>% 
  dplyr::mutate(Site = "BKS", Year = 2020)

BRL20stubble <- BRL20stubble %>% 
  dplyr::mutate(Site = "BRL", Year = 2020)

# bind the rows together to help with manipulation
heber_stubble_data <- bind_rows(A5119stubble, 
                                BKN19stubble, 
                                BRL19stubble, 
                                A5120stubble, 
                                BKN20stubble, 
                                BKS20stubble, 
                                BRL20stubble, 
                                heber_stubble_2018)

# rename the slightly different column name in the Heber data to match the
# column name in the White Mountains data
heber_stubble_data <- heber_stubble_data %>% 
  dplyr::rename("Species/Category Code" = "Species/Category.Code")

# rename the slightly different column name in the Heber data to match the
# column name in the White Mountains data
heber_stubble_data <- heber_stubble_data %>% 
  dplyr::rename("Species/Category Name" = "Species/Category.Name")

# arrange the data frame in ascending order by year
# this helps seeing the data in order from when it was collected
heber_stubble_data <- heber_stubble_data %>% 
  dplyr::arrange(Year)

# print the data frame to view the changes
heber_stubble_data
```

The Heber data is now in the same format as the 2019 White Mountains data.
However, we need to rename columns in these data frames to make them consistent
with the 2017 and 2018 White Mountains data.

First, add a "Site" column and a "Year" column to the 2019 White Mountains data.
This will make it easier to keep track of the data as we clean it up.
```{r mutate 2019 White Mountains data}
BGW19stubble <- BGW19stubble %>% dplyr::mutate(Site = "Boggy", Year = 2019)

WCS19stubble <- WCS19stubble %>% dplyr::mutate(Site = "Wildcat", Year = 2019)

# print the data frames to view the changes
BGW19stubble

WCS19stubble

# bind the rows together for easier manipulation
wm_stubble_2019 <- dplyr::bind_rows(BGW19stubble, WCS19stubble)

wm_stubble_2019
```

Next, we'll combine the 2019 White Mountains data with Heber data. We'll rename 
the columns and drop other columns to make it consistent with the 2017 and 2018
White Mountains data.
```{r rename columns}
# bind data together for easier manipulation
mutated_stubble_data <- bind_rows(wm_stubble_2019, heber_stubble_data)

# rename the "Species/Category Code" column to "Species" 
# to be consistent with the 2017 & 2018 data
mutated_stubble_data <- mutated_stubble_data %>% 
  dplyr::rename(Species = "Species/Category Code")

# rename the "Sample" column to "Record" 
# to be consistent with the 2017 & 2018 data
mutated_stubble_data <- mutated_stubble_data %>% 
  dplyr::rename(Record = "Sample")

# remove the columns that are not in the 2017 & 2018 data
mutated_stubble_data <- mutated_stubble_data %>% 
  dplyr::select(-c("Qualifier", "Transect", "Species/Category Name"))

# rename the "Height" column to "Height-in" 
# to be consistent with the 2017 & 2018 data
mutated_stubble_data <- mutated_stubble_data %>% 
  dplyr::rename("Height-in" = "Height")

# add a "Condition" column to be consistent with the 2017 and 2018 data
mutated_stubble_data <- mutated_stubble_data %>% 
  dplyr::mutate(Condition = NA)

# view the changes to the data frame
mutated_stubble_data
```

Combine data frames together so all the stubble height data is in the same place.
```{r bind data together}
stubble_data <- bind_rows(BGW17stubble, 
                          WCS17stubble, 
                          BGW18stubble, 
                          WCS18stubble, 
                          mutated_stubble_data)

# arrange the data frame in ascending order by year
# this helps seeing the data in order from when it was collected
stubble_data <- stubble_data %>% 
  arrange(Year)

print(stubble_data)
```

We have 1 missing height value in the data that we need to remove. Not sure
how this happened, but we need to remove it nonetheless.
```{r remove missing data}
## clean up the data by removing any missing values
stubble_data <- stubble_data %>% 
  tidyr::drop_na("Height-in")

print(stubble_data)
```

We need to convert the "Species" column which is currently a character type into
a factor type. R treats factors differently than characters, with the main
difference being that factors have levels. Levels can be ranked in order
(e.g., low to high, smallest to largest).
```{r code species as factors}
# convert the "Species" column from character to factor
stubble_data$Species <- stubble_data %>% 
  pull(Species) %>% 
  forcats::as_factor()

# set the factor level for data that has missing species data
# i.e. code missing species data (NA's) as "Missing"
stubble_data$Species <- stubble_data %>% 
  pull(Species) %>% 
  fct_explicit_na(na_level = "Missing")

# reorder the levels by the frequency in which they appear in the data
# i.e. species that have the most observations are coded as the highest level
stubble_data$Species <- stubble_data %>% 
  pull(Species) %>% 
  fct_infreq()

# print the data frame to view the changes
stubble_data
```

```{r replace POPR values with POA}
stubble_data <- stubble_data %>% 
  dplyr::mutate(Species = replace(Species, Species == "POPR" | Species == "POFE", "POA"))

stubble_data
```

Plot a histogram of Kentucky bluegrass to visualize the distribution of stubble heights. 
```{r Boggy 2017 Histogram}
stubble_data %>% 
        dplyr::filter(Site == "Boggy" & Year == "2017") %>% 
        dplyr::filter(Species == "POA") %>% 
        pull("Height-in") %>% 
        hist(breaks = seq(0, 10, by = 1), 
             axes = FALSE,
             main = "Frequency Count of Poa spp.",
             xlab = "Stubble Height (in)",
             xlim = c(0, 10),
             ylim = c(0, 100))
axis(1, at = seq(0, 10, by = 1), 
     labels = seq(0, 10, by = 1), 
     cex.axis = 0.75, las = 2)
axis(2, at = seq(0, 100, by = 10), 
     labels = seq(0, 100, by = 10), 
     cex.axis = 0.75, las = 2)
mtext("Boggy 2017", 3, adj = 0.5, line = -1)
```

```{r Wildcat 2017 Histogram}
stubble_data %>% 
        dplyr::filter(Site == "Wildcat" & Year == "2017") %>% 
        dplyr::filter(Species == "POA") %>% 
        pull("Height-in") %>% 
        hist(breaks = seq(0, 10, by = 1), 
             axes = FALSE,
             main = "Frequency Count of Poa spp.",
             xlab = "Stubble Height (in)",
             xlim = c(0, 10),
             ylim = c(0, 100))
axis(1, at = seq(0, 10, by = 1), 
     labels = seq(0, 10, by = 1), 
     cex.axis = 0.75, las = 2)
axis(2, at = seq(0, 100, by = 10), 
     labels = seq(0, 100, by = 10), 
     cex.axis = 0.75, las = 2)
mtext("Wildcat 2017", 3, adj = 0.5, line = -1)
```

```{r Boggy 2019 Histogram}
stubble_data %>% 
        dplyr::filter(Site == "Boggy" & Year == "2019") %>% 
        dplyr::filter(Species == "POA") %>% 
        pull("Height-in") %>% 
        hist(breaks = seq(0, 10, by = 1), 
             axes = FALSE,
             main = "Frequency Count of Poa spp.",
             xlab = "Stubble Height (in)",
             xlim = c(0, 10),
             ylim = c(0, 100))
axis(1, at = seq(0, 10, by = 1), 
     labels = seq(0, 10, by = 1), 
     cex.axis = 0.75, las = 2)
axis(2, at = seq(0, 100, by = 10), 
     labels = seq(0, 100, by = 10), 
     cex.axis = 0.75, las = 2)
mtext("Boggy 2019", 3, adj = 0.5, line = -1)
```

Get the summary statistics for the White Mountains stubble height data.
```{r White Mountains stubble stats}
BGW17stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Boggy" & Year == 2017) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BGW18stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Boggy" & Year == 2018) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

WCS17stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Wildcat" & Year == 2017) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

WCS18stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Wildcat" & Year == 2018) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BGW19stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Boggy" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

WCS19stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Wildcat" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

WCS19stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "Wildcat" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BGW17stubblestats
BGW18stubblestats
WCS17stubblestats
WCS18stubblestats
BGW19stubblestats
WCS19stubblestats
```

Get the summary stats for the Heber stubble height data.
# TODO this would be good candidate for a custom function
```{r Heber stubble stats}
BKS18stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BKS" & Year == 2018) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BRL18stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BRL" & Year == 2018) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

A5119stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "A51" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BKN19stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BKN" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BRL19stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BRL" & Year == 2019) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

A5120stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "A51" & Year == 2020) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BKN20stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BKN" & Year == 2020) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BKS20stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BKS" & Year == 2020) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BRL20stubblestats <- stubble_data %>% 
  dplyr::filter(Site == "BRL" & Year == 2020) %>% 
        group_by(Species) %>% 
        rstatix::get_summary_stats("Height-in", type = "common")

BKS18stubblestats
BRL18stubblestats
A5119stubblestats
BKN19stubblestats
BRL19stubblestats
A5120stubblestats
BKN20stubblestats
BKS20stubblestats
BRL20stubblestats
```

Rearrange the order of the species count, descending from the species 
with the highest number of observations (n) to the species with 
the lowest number of observations.
```{r}
BGW17stubblestats <- BGW17stubblestats %>% dplyr::arrange(desc(n))

WCS17stubblestats <- WCS17stubblestats %>% dplyr::arrange(desc(n))

BGW18stubblestats <- BGW18stubblestats %>% dplyr::arrange(desc(n))

WCS18stubblestats <- WCS18stubblestats %>% dplyr::arrange(desc(n))

BGW19stubblestats <- BGW19stubblestats %>% dplyr::arrange(desc(n))

WCS19stubblestats <- WCS19stubblestats %>% dplyr::arrange(desc(n))

BKS18stubblestats <- BKS18stubblestats %>% dplyr::arrange(desc(n))

BRL18stubblestats <- BRL18stubblestats %>% dplyr::arrange(desc(n))

A5119stubblestats <- A5119stubblestats %>% dplyr::arrange(desc(n))

BKN19stubblestats <- BKN19stubblestats %>% dplyr::arrange(desc(n))

BRL19stubblestats <- BRL19stubblestats %>% dplyr::arrange(desc(n))

A5120stubblestats <- A5120stubblestats %>% dplyr::arrange(desc(n))

BKN20stubblestats <- BKN20stubblestats %>% dplyr::arrange(desc(n))

BKS20stubblestats <- BKS20stubblestats %>% dplyr::arrange(desc(n))

BRL20stubblestats <- BRL20stubblestats %>% dplyr::arrange(desc(n))

BGW17stubblestats
WCS17stubblestats
BGW18stubblestats
WCS18stubblestats
BGW19stubblestats
WCS19stubblestats
BKS18stubblestats
BRL18stubblestats
A5119stubblestats
BKN19stubblestats
BRL19stubblestats
A5120stubblestats
BKN20stubblestats
BKS20stubblestats
BRL20stubblestats
```

Take the top 3 species for each site. 
```{r eval=FALSE, include=FALSE}
BGW17stubblestats_top3 <- BGW17stubblestats %>% dplyr::slice(1:3)

BGW18stubblestats_top3 <- BGW18stubblestats %>% dplyr::slice(1:3)

BGW19stubblestats_top3 <- BGW19stubblestats %>% dplyr::slice(1:3)

WCS17stubblestats_top3 <- WCS17stubblestats %>% dplyr::slice(1:3)

WCS18stubblestats_top3 <- WCS18stubblestats %>% dplyr::slice(1:3)

WCS19stubblestats_top3 <- WCS19stubblestats %>% dplyr::slice(1:3)

BKS18stubblestats_top3 <- BKS18stubblestats %>% dplyr::slice(1:3)

BRL18stubblestats_top3 <- BRL18stubblestats %>% dplyr::slice(1:3)

A5119stubblestats_top3 <- A5119stubblestats %>% dplyr::slice(1:3)

BKN19stubblestats_top3 <- BKN19stubblestats %>% dplyr::slice(1:3)

BRL19stubblestats_top3 <- BRL19stubblestats %>% dplyr::slice(1:3)

A5120stubblestats_top3 <- A5120stubblestats %>% dplyr::slice(1:3)

BKN20stubblestats_top3 <- BKN20stubblestats %>% dplyr::slice(1:3)

BKS20stubblestats_top3 <- BKS20stubblestats %>% dplyr::slice(1:3)

BRL20stubblestats_top3 <- BRL20stubblestats %>% dplyr::slice(1:3)

BGW17stubblestats_top3
BGW18stubblestats_top3
BGW19stubblestats_top3
WCS17stubblestats_top3
WCS18stubblestats_top3
WCS19stubblestats_top3
BKS18stubblestats_top3
BRL18stubblestats_top3
A5119stubblestats_top3
BKN19stubblestats_top3
BRL19stubblestats_top3
A5120stubblestats_top3
BKN20stubblestats_top3
BKS20stubblestats_top3
BRL20stubblestats_top3
```

```{r drop unused levels and reorder levels White Mountains}
BGW17stubblestats_top3$Species <- BGW17stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BGW17stubblestats_top3$Species <- BGW17stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BGW18stubblestats_top3$Species <- BGW18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BGW18stubblestats_top3$Species <- BGW18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BGW19stubblestats_top3$Species <- BGW19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BGW19stubblestats_top3$Species <- BGW19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

WCS17stubblestats_top3$Species <- WCS17stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

WCS18stubblestats_top3$Species <- WCS18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

WCS19stubblestats_top3$Species <- WCS19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()
```

```{r drop unused levels and reorder levels Heber}
BKS18stubblestats_top3$Species <- BKS18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BKS18stubblestats_top3$Species <- BKS18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BRL18stubblestats_top3$Species <- BRL18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BRL18stubblestats_top3$Species <- BRL18stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

A5119stubblestats_top3$Species <- A5119stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

A5119stubblestats_top3$Species <- A5119stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BKN19stubblestats_top3$Species <- BKN19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BKN19stubblestats_top3$Species <- BKN19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BRL19stubblestats_top3$Species <- BRL19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BRL19stubblestats_top3$Species <- BRL19stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

A5120stubblestats_top3$Species <- A5120stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

A5120stubblestats_top3$Species <- A5120stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BKN20stubblestats_top3$Species <- BKN20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BKN20stubblestats_top3$Species <- BKN20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BKS20stubblestats_top3$Species <- BKS20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BKS20stubblestats_top3$Species <- BKS20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()

BRL20stubblestats_top3$Species <- BRL20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_drop()

BRL20stubblestats_top3$Species <- BRL20stubblestats_top3 %>% 
  pull(Species) %>% 
  forcats::fct_inorder()
```


```{r Boggy 2017 Stubble Height Figure}
ggplot(BGW17stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Poa pratensis", "Carex sp.", "Poa fendleriana")) +
  labs(title = "Boggy Creek Stubble Height 2017", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the  error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BGW17stubblestats_top3$mean[1] + BGW17stubblestats_top3$ci[1] + 1), 
           label = signif(BGW17stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BGW17stubblestats_top3$mean[2] + BGW17stubblestats_top3$ci[2] + 1), 
           label = signif(BGW17stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (BGW17stubblestats_top3$mean[3] + BGW17stubblestats_top3$ci[3] + 1), 
           label = signif(BGW17stubblestats_top3$mean[3], 2)) +
  # annotate(geom = "text", x = 2, y = 4.75, label = signif(BGW17stubblestats_top3$mean[2], 2)) +
  # annotate(geom = "text", x = 3, y = 4, label = signif(BGW17stubblestats_top3$mean[3], 2)) +

# add the number of samples inside the bars
  annotate(geom = "text", x = 1, y = (BGW17stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BGW17stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (BGW17stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", BGW17stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BGW17stubblestats_top3$mean[3]/2), 
           label = paste0("n = ", BGW17stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)
# ggsave("Boggy-2017-Stubble-Height-n-samples-95CI.jpg",
#    path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
WCS17stubblestats_top3
```


```{r Wildcat 2017 Stubble Height Figure}
ggplot(WCS17stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Poa pratensis", "Carex sp.", "Poa fendleriana")) +
  labs(title = "Wildcat Creek Stubble Height 2017", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 5))) +

# add stubble height values above the  error bars
# round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (WCS17stubblestats_top3$mean[1] + WCS17stubblestats_top3$ci[1] + 1), 
           label = signif(WCS17stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (WCS17stubblestats_top3$mean[2] + WCS17stubblestats_top3$ci[2] + 1), 
           label = signif(WCS17stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (WCS17stubblestats_top3$mean[3] + WCS17stubblestats_top3$ci[3] + 1), 
           label = signif(WCS17stubblestats_top3$mean[3], 2)) +

# add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (WCS17stubblestats$mean[1]/2), 
           label = paste0("n = ", WCS17stubblestats$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (WCS17stubblestats$mean[2]/3), 
           label = paste0("n = ", WCS17stubblestats$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (WCS17stubblestats$mean[3]/2), 
           label = paste0("n = ", WCS17stubblestats$n[3]), 
           size = 3, 
           alpha = 0.75)
  
ggsave("Wildcat-2017-Stubble-Height-n-samples-95CI.jpg",
path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
BGW18stubblestats_top3
```


```{r Boggy 2018 Stubble Height Figure}
ggplot(BGW18stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.25) +
  labs(title = "Boggy Creek Stubble Height 2018", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.1) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

# add stubble height values above the  error bars
# round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BGW18stubblestats_top3$mean[1] + BGW18stubblestats_top3$ci[1] + 1), 
           label = signif(BGW18stubblestats_top3$mean[1], 2)) +
  
# add the number of samples inside the bars
  annotate(geom = "text", x = 1, y = (BGW18stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BGW18stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75)
  
ggsave("Boggy-2018-Stubble-Height-n-samples.jpg",
   path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
WCS18stubblestats_top3
```


```{r Wildcat 2018 Stubble Height Figure}
ggplot(WCS18stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.25) +
  labs(title = "Wildcat Creek Stubble Height 2018", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.1) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +
  
  # add stubble height values above the  error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (WCS18stubblestats_top3$mean[1] + WCS18stubblestats_top3$ci[1] + 1), 
           label = signif(WCS18stubblestats_top3$mean[1], 2)) +
  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (WCS18stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", WCS18stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) 
  
ggsave("Wildcat-2018-Stubble-Height-n-samples.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
BGW19stubblestats_top3
```

```{r Boggy 2019 Stubble Height Figure}
ggplot(BGW19stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Poa sp.", "Carex sp.", "Bromus inermis")) +
  labs(title = "Boggy Creek Stubble Height 2019", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 11), breaks = seq(0, 11, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the  error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BGW19stubblestats_top3$mean[1] + BGW19stubblestats_top3$ci[1] + 1), 
           label = signif(BGW19stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BGW19stubblestats_top3$mean[2] + BGW19stubblestats_top3$ci[2] + 1), 
           label = signif(BGW19stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (BGW19stubblestats_top3$mean[3] + BGW19stubblestats_top3$ci[3] + 1), 
           label = signif(BGW19stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", x = 1, y = (BGW19stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BGW19stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (BGW19stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", BGW19stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BGW19stubblestats_top3$mean[3]/3), 
           label = paste0("n = ", BGW19stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

ggsave("Boggy-2019-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
WCS19stubblestats_top3
```

```{r Wildcat 2019 Stubble Height Figure}
ggplot(WCS19stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Poa sp.", "Carex sp.", "Pascopyrum smithii")) +
  labs(title = "Wildcat Creek Stubble Height 2019", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (WCS19stubblestats_top3$mean[1] + WCS19stubblestats_top3$ci[1] + 1), 
           label = signif(WCS19stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (WCS19stubblestats_top3$mean[2] + WCS19stubblestats_top3$ci[2] + 1), 
           label = signif(WCS19stubblestats_top3$mean[2], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (WCS19stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", WCS19stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (WCS19stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", WCS19stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (WCS19stubblestats_top3$mean[3]/2), 
           label = paste0("n = ", WCS19stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

ggsave("Wildcat-2019-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/white-mountains"))
```

```{r}
BKS18stubblestats_top3
```


```{r Black Canyon South 2018 Stubble Height Figure}
BKS18plot <- ggplot(BKS18stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.25) +
  labs(title = expression(atop("Black Canyon South", paste("Stubble Height"))), 
       subtitle = "2018") +
  ylab("") +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 15, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.1) +
  theme(plot.title = element_text(hjust = 0.5, size = 11),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10)),
        legend.position = "none") +
  
  # add stubble height values above the  error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BKS18stubblestats_top3$mean[1] + BKS18stubblestats_top3$ci[1] + 1), 
           label = signif(BKS18stubblestats_top3$mean[1], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", x = 1, y = (BKS18stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BKS18stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75)
  
# ggsave("Black-Canyon-South-2018-Stubble-Height-n-samples-95CI.jpg",
#       path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))

BKS18plot
```

```{r}
BRL18stubblestats_top3
```

```{r Bear 2018 Stubble Height Figure}
BRL18plot <- ggplot(BRL18stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.25) +
  labs(title = expression(atop("Bear", paste("Stubble Height"))), subtitle = "2018") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 15, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.1) +
  theme(plot.title = element_text(hjust = 0.5, size = 11),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10)),
        legend.position = "none") +
  
  # add stubble height values above the  error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BRL18stubblestats_top3$mean[1] + BRL18stubblestats_top3$ci[1] + 1), 
           label = signif(BRL18stubblestats_top3$mean[1], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", x = 1, y = (BRL18stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BRL18stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75)
  
# ggsave("Bear-2018-Stubble-Height-n-samples-95CI.jpg",
#       path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r Combine Heber 2018 Stubble Height Figures}
ggpubr::ggarrange(BRL18plot, BKS18plot,
                  widths = c(1, 1),
                  ncol = 2,
                  align = "h")

ggsave("Heber-Stubble-Height-2018-n-samples-95CI.jpg",
       path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```


```{r}
heber_stubble_data <- stubble_data %>% dplyr::filter(Site != "Boggy")
heber_stubble_data <- heber_stubble_data %>% dplyr::filter(Site != "Wildcat")
```



```{r Get Summary Stats Heber 2019}

heber_2019_stubble_stats <- heber_stubble_data_merge_poa %>% 
  dplyr::filter(Year == 2019) %>% 
  group_by(Species) %>% 
  rstatix::get_summary_stats("Height-in", type = "common")

print(heber_2019_stubble_stats)
```

```{r}
heber_2019_stubble_stats <- heber_2019_stubble_stats %>% dplyr::arrange(desc(n))

print(heber_2019_stubble_stats)
```

```{r}
heber_2019_stubble_stats$Species %>% levels()
```

```{r}
heber_2019_stubble_stats$Species <- heber_2019_stubble_stats %>% 
  pull(Species) %>% 
  forcats::fct_drop()
```

```{r}
heber_2019_stubble_stats$Species %>% levels()
```

```{r}
heber_2019_stubble_stats$Species <- heber_2019_stubble_stats %>% 
  pull(Species) %>% 
  forcats::fct_inorder()
```

```{r get_legend function}
get_legend <- function(myggplot){
  tmp <- ggplot_gtable(ggplot_build(myggplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}
```

```{r}
levels(heber_2019_stubble_stats$Species)
```

```{r}
heber_2019_species <- as.character(levels(heber_2019_stubble_stats$Species))

heber_2019_species
```


```{r Heber 2019 Stubble Height All Sites Combined}
heber2019plot <- ggplot(
  heber_2019_stubble_stats, aes(fill = Species, y = mean, x = Species)
) +
  geom_col(width = 0.25) +
  labs(
    title = expression(
      atop("Heber All Sites Combined", paste("Stubble Height"))
    ),
    subtitle = "2019"
  ) +
  ylab("") +
  scale_y_continuous(
    limits = c(0, 15),
    breaks = seq(0, 15, by = 1)
  ) +
  geom_errorbar(
    aes(ymin = (mean - ci), ymax = (mean + ci)),
    position = position_dodge(0.5),
    width = 0.1
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 11),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
    axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))
  )

heber2019plot
```

```{r}
heber2019build <- ggplot_build(heber2019plot)

heber_color_scheme <- unique(heber2019build$data[[1]]["fill"])

heber_color_scheme
```

```{r}
heber_2019_color_scheme <- heber_color_scheme %>% 
  mutate(species = heber_2019_species)

heber_2019_color_scheme
```

```{r Heber 2019 Stubble Height All Sites Scale Fill Manual}
heber_2019_stubble_stats %>% 
ggplot(
  aes(y = mean, x = Species, fill = Species)
) +
  geom_col(width = 0.25) +
  scale_discrete_manual(aesthetics = "fill", 
                        breaks = heber_2019_color_scheme$species,
                        values = heber_2019_color_scheme$fill) +
  labs(
    title = expression(
      atop("Heber All Sites Combined", paste("Stubble Height"))
    ),
    subtitle = "2019"
  ) +
  ylab("") +
  scale_y_continuous(
    limits = c(0, 15),
    breaks = seq(0, 15, by = 1)
  ) +

  geom_errorbar(
    aes(ymin = (mean - ci), ymax = (mean + ci)),
    position = position_dodge(0.5),
    width = 0.1
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 11),
    plot.subtitle = element_text(hjust = 0.5),
    axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
    axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))
  )

ggsave("Heber-Stubble-Height-2019-all-sites-combined.jpg",
       path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r}
heber_2019_color_scheme$fill
```


```{r}
heber2019_legend <- get_legend(heber2019plot)
```

```{r}
heber_stubble_data_merge_poa
```

```{r}
levels(heber_stubble_data_merge_poa$Species)
```

```{r}
heber_stubble_data_merge_poa$Species <- 
heber_stubble_data_merge_poa %>% 
  pull(Species) %>%
  fct_drop()
```

```{r}
levels(heber_stubble_data_merge_poa$Species)
```

```{r}
A5119stubble <- heber_stubble_data_merge_poa %>% 
  dplyr::filter(Site == "A51" & Year == 2019)
print(A5119stubble)
```

```{r}
levels(A5119stubble$Species)
```

```{r}
A5119_stubble_stats <- A5119stubble %>%
  group_by(Species) %>% 
  rstatix::get_summary_stats("Height-in", type = "common")
print(A5119_stubble_stats)
```


```{r A51 2019 Stubble Height Figure}
A5119plot <- ggplot(A5119_stubble_stats, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_discrete_manual(aesthetics = "fill", 
                        breaks = heber_2019_color_scheme$species,
                        values = heber_2019_color_scheme$fill) +
  labs(title = expression(atop("Fifty One", paste("Stubble Height"))), subtitle = "2019") +
  ylab("") +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 15, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5, size = 11),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
        axis.ticks = element_blank(),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 0))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (A5119stubblestats_top3$mean[1] + A5119stubblestats_top3$ci[1] + 1), 
           label = signif(A5119stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (A5119stubblestats_top3$mean[2] + A5119stubblestats_top3$ci[2] + 1), 
           label = signif(A5119stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (A5119stubblestats_top3$mean[3] + A5119stubblestats_top3$ci[3] + 1), 
           label = signif(A5119stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (A5119stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", A5119stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (A5119stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", A5119stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (A5119stubblestats_top3$mean[3]/3), 
           label = paste0("n = ", A5119stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text",
           x = 2,
           y = 10,
           size = 3,
           label = "n = number of samples",
           alpha = 0.75)

A5119plot

ggsave("Fifty-One-2019-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r}
BKN19stubblestats_top3
```

```{r}
BKN19stubblestats_top3$mean[3] + BKN19stubblestats_top3$ci[3]

BKN19stubblestats_top3$mean[3] - BKN19stubblestats_top3$ci[3]
```

Because the HECO has really strange confidence interval (it goes from 27 to -5), we'll just omit it in the figure by setting it to NA.
```{r}
BKN19stubblestats_top3$ci[3] <- NA
```

```{r}
BKN19stubblestats_top3
```

```{r BKN 2019 Stubble Height Figure}
BKN19plot <- ggplot(BKN19stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Bouteloua gracilis", "Pascopyrum smithii", "Hesperostipa comata")) +
  labs(title = expression(atop("Black Canyon North", 
                               paste("Stubble Height"))), 
       subtitle = "2019") +
  ylab("") +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 15, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5, size = 11),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10)),
        axis.ticks = element_blank(),
        legend.position = "none") +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BKN19stubblestats_top3$mean[1] + BKN19stubblestats_top3$ci[1] + 1), 
           label = signif(BKN19stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKN19stubblestats_top3$mean[2] + BKN19stubblestats_top3$ci[2] + 1), 
           label = signif(BKN19stubblestats_top3$mean[2], 2)) +
  # omit the confidence interval because it goes negative which doesn't make sense
  annotate(geom = "text", 
           x = 3, 
           y = 12, 
           label = signif(BKN19stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (BKN19stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BKN19stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKN19stubblestats_top3$mean[2]/4), 
           label = paste0("n = ", BKN19stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BKN19stubblestats_top3$mean[3]/2), 
           label = paste0("*n = ", BKN19stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

BKN19plot

ggsave("Black-Canyon-North-2019-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r}
BRL19stubblestats_top3
```

```{r}
BRL19stubblestats_top3$mean[3] + BRL19stubblestats_top3$ci[3]

BRL19stubblestats_top3$mean[3] - BRL19stubblestats_top3$ci[3]
```

Because the PASM has really strange confidence interval (it goes from 10.3 to -2.3), we'll just the omit the CI for that species in the figure by setting it to NA.
```{r}
BRL19stubblestats_top3$ci[3] <- NA
```

```{r}
BRL19stubblestats_top3
```

```{r BRL 2019 Stubble Height Figure}
BRL19plot <- ggplot(BRL19stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Bouteloua gracilis", "Elymus elymoides", "Pascopyrum smithii")) +
  labs(title = expression(atop("Bear", paste("Stubble Height"))), subtitle = "2019") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 15, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5, size = 11),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 5, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10)),
        axis.ticks = element_blank(),
        legend.position = "none") +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BRL19stubblestats_top3$mean[1] + BRL19stubblestats_top3$ci[1] + 1), 
           label = signif(BRL19stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BRL19stubblestats_top3$mean[2] + BRL19stubblestats_top3$ci[2] + 1), 
           label = signif(BRL19stubblestats_top3$mean[2], 2)) +
  # omit the confidence inteval because it goes negative which doesn't make sense
  annotate(geom = "text", 
           x = 3, 
           y = 5, 
           label = signif(BRL19stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (BRL19stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BRL19stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = 0, 
           label = paste0("n = ", BRL19stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BRL19stubblestats_top3$mean[3]/2), 
           label = paste0("*n = ", BRL19stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

BRL19plot

ggsave("Bear-2019-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```


```{r Combine Heber 2019 Stubble Height Figures}
ggpubr::ggarrange(BRL19plot, BKN19plot, A5119plot,
                  widths = c(1, 1, 1),
                  ncol = 3,
                  align = "h")

# ggsave("Heber-Stubble-Height-2019-n-samples-95CI.jpg",
#        height = 6.5,
#        width = 9,
#        units = "in",
#        path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```


```{r}
A5120stubblestats_top3
```

```{r A51 2020 Stubble Height Figure}
ggplot(A5120stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Pascopyrum smithii", "Aristida sp.", "Koeleria macrantha")) +
  labs(title = "Fifty One Stubble Height 2020", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (A5120stubblestats_top3$mean[1] + A5120stubblestats_top3$ci[1] + 1), 
           label = signif(A5120stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (A5120stubblestats_top3$mean[2] + A5120stubblestats_top3$ci[2] + 1), 
           label = signif(A5120stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (A5120stubblestats_top3$mean[3] + A5120stubblestats_top3$ci[3] + 1), 
           label = signif(A5120stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (A5120stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", A5120stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (A5120stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", A5120stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (A5120stubblestats_top3$mean[3]/2), 
           label = paste0("n = ", A5120stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)
ggsave("Fifty-One-2020-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```


```{r}
BKN20stubblestats_top3
```

```{r BKN 2020 Stubble Height Figure}
ggplot(BKN20stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Bouteloua gracilis", "Aristida sp.", "Bouteloua curtipendula")) +
  labs(title = "Black Canyon North Stubble Height 2020", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BKN20stubblestats_top3$mean[1] + BKN20stubblestats_top3$ci[1] + 1), 
           label = signif(BKN20stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKN20stubblestats_top3$mean[2] + BKN20stubblestats_top3$ci[2] + 1), 
           label = signif(BKN20stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (BKN20stubblestats_top3$mean[3] + BKN20stubblestats_top3$ci[3] + 1), 
           label = signif(BKN20stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (BKN20stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BKN20stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKN20stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", BKN20stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = 0.5, 
           label = paste0("n = ", BKN20stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

ggsave("Black-Canyon-North-2020-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r}
BKS20stubblestats_top3
```

```{r BKS 2020 Stubble Height Figure}
ggplot(BKS20stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Poa sp.", "Muhlenbergia montana", "Bromus inermis")) +
  labs(title = "Black Canyon South Stubble Height 2020", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BKS20stubblestats_top3$mean[1] + BKS20stubblestats_top3$ci[1] + 1), 
           label = signif(BKS20stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKS20stubblestats_top3$mean[2] + BKS20stubblestats_top3$ci[2] + 1), 
           label = signif(BKS20stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (BKS20stubblestats_top3$mean[3] + BKS20stubblestats_top3$ci[3] + 1), 
           label = signif(BKS20stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (BKS20stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BKS20stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = (BKS20stubblestats_top3$mean[2]/2), 
           label = paste0("n = ", BKS20stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BKS20stubblestats_top3$mean[3]/2), 
           label = paste0("n = ", BKS20stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)

ggsave("Black-Canyon-South-2020-Stubble-Height-n-samples-95CI-test.jpg",
       path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```

```{r}
BRL20stubblestats_top3
```

```{r BRL 2020 Stubble Height Figure}
ggplot(BRL20stubblestats_top3, aes(fill = Species, y = mean, x = Species)) +
  geom_col(width = 0.75) +
  scale_fill_discrete(name = "Species", labels = c("Bouteloua gracilis", "Poa sp.", "Aristida sp.")) +
  labs(title = "Bear Stubble Height 2020", caption = "n = number of samples") +
  ylab("Average Stubble Height (Inches) ± 95% CI") +
  scale_y_continuous(limits = c(0, 10), breaks = seq(0, 10, by = 1)) +
  geom_errorbar(aes(ymin = (mean-ci), ymax = (mean+ci)), position = position_dodge(0.5), width = 0.25) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        axis.text.x = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
        axis.text.y = element_text(margin = margin(t = 0, r = 0, b = 0, l = 10))) +

  # add stubble height values above the error bars
  # round the mean stubble height value using significant figures
  annotate(geom = "text", 
           x = 1, 
           y = (BRL20stubblestats_top3$mean[1] + BRL20stubblestats_top3$ci[1] + 1), 
           label = signif(BRL20stubblestats_top3$mean[1], 2)) +
  annotate(geom = "text", 
           x = 2, 
           y = (BRL20stubblestats_top3$mean[2] + BRL20stubblestats_top3$ci[2] + 1), 
           label = signif(BRL20stubblestats_top3$mean[2], 2)) +
  annotate(geom = "text", 
           x = 3, 
           y = (BRL20stubblestats_top3$mean[3] + BRL20stubblestats_top3$ci[3] + 1), 
           label = signif(BRL20stubblestats_top3$mean[3], 2)) +

  # add the number of samples inside the bars
  annotate(geom = "text", 
           x = 1, 
           y = (BRL20stubblestats_top3$mean[1]/2), 
           label = paste0("n = ", BRL20stubblestats_top3$n[1]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 2, 
           y = 0.25, 
           label = paste0("n = ", BRL20stubblestats_top3$n[2]), 
           size = 3, 
           alpha = 0.75) +
  annotate(geom = "text", 
           x = 3, 
           y = (BRL20stubblestats_top3$mean[3]/3), 
           label = paste0("n = ", BRL20stubblestats_top3$n[3]), 
           size = 3, 
           alpha = 0.75)
ggsave("Bear-2020-Stubble-Height-n-samples-95CI.jpg",
      path = paste0(getwd(),"/figures", "/stubbleheight", "/heber"))
```
